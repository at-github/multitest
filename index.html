<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charSet="utf-8"/>
    <title>multi | test</title>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <style>
    ul {
      list-style: none;
      padding: 0;
    }

    #container {
      display: flex;
      flex-direction: row;
    }

    nav {
      min-width: 200px;
    }

    #map {
      width: 600px;
      height: 600px;
    }
  </style>
  <body>
      <div id="container">
        <nav>
          <ul>
            <li>
              <input type="checkbox" id="porte-champerret" data-lat="48.885651" data-lng="2.291234" data-title="Porte de Champerret" />
              <label for="porte-champerret">Porte de Champerret</label>
            </li>
            <li>
              <input type="checkbox" id="notre-dame" data-lat="48.852846" data-lng="2.350412" data-title="Notre dame" />
              <label for="notre-dame">Notre dame</label>
            </li>
          </ul>
        </nav>
        <section>
          <div id="map"></div>
        </section>
      </div>
      <script>
        const map = L.map('map').setView([48.8781322 , 2.3238234], 13);
        const popups = {}

        L.tileLayer(
          'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
          {
            maxZoom: 19,
            attribution: 'Made for multi technical test | &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
          }
        ).addTo(map);

        document.onreadystatechange = () => {
          if (document.readyState === 'complete') {
            document.querySelectorAll('nav input').forEach(input => {
              input.addEventListener('change', (event) => {
                const element = event.target

                try {
                  let lat = element.dataset.lat
                  if (lat === undefined || lat === '')
                    throw new Error('Missing lat')

                  const lng = element.dataset.lng
                  if (lng === undefined || lng === '')
                    throw new Error('Missing lng')

                  const title = element.dataset.title
                  if (!title)
                    throw new Error('Missing title')

                  const id = element.id
                  if (!id)
                    throw new Error('Missing id')

                  if (element.checked === true) {
                    popups[element.id] = L.popup()
                      .setLatLng([lat, lng])
                      .setContent(title)
                      .openOn(map);
                  } else {
                    if (popups[element.id])
                      popups[element.id].close()
                  }
                } catch(error) {
                  console.error(error)
                  alert('Désolé un problème technique est survenu')
                }
              })
            })
          }
        }
      </script>
  </body>
</html>
